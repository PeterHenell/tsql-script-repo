SELECT event_name
			,event_data.value('(event/@timestamp)[1]', 'datetime') AS [timestamp]
		,CASE WHEN event_name in ('clr_allocation_failure','clr_virtual_alloc_failure') THEN event_data.value('(event/data[@name="allocation_size"]/value)[1]', 'bigint') ELSE NULL END AS [allocation_size]
		,CASE WHEN event_name in ('clr_virtual_alloc_failure') THEN event_data.value('(event/data[@name="allocation_type"]/text)[1]', 'nvarchar(30)') ELSE NULL END AS [allocation_type]
		,CASE WHEN event_name in ('security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="api_name"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [api_name]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="available_extended_virtual_address_space_kb"]/value)[1]', 'bigint') ELSE NULL END AS [available_extended_virtual_address_space_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="available_page_file_kb"]/value)[1]', 'bigint') ELSE NULL END AS [available_page_file_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="available_physical_memory_kb"]/value)[1]', 'bigint') ELSE NULL END AS [available_physical_memory_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="available_virtual_address_space_kb"]/value)[1]', 'bigint') ELSE NULL END AS [available_virtual_address_space_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="awe_kb"]/value)[1]', 'bigint') ELSE NULL END AS [awe_kb]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="broker"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [broker]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded','memory_broker_ring_buffer_recorded','memory_node_oom_ring_buffer_recorded','scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded','security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="call_stack"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [call_stack]
		,CASE WHEN event_name in ('security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="calling_api_name"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [calling_api_name]
		,CASE WHEN event_name in ('clr_allocation_failure','clr_virtual_alloc_failure','error_reported','memory_node_oom_ring_buffer_recorded','wait_info','wait_info_external') THEN event_data.value('(event/action[@name="callstack"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [callstack]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="category"]/text)[1]', 'nvarchar(10)') ELSE NULL END AS [category]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="committed_kb"]/value)[1]', 'bigint') ELSE NULL END AS [committed_kb]
		,CASE WHEN event_name in ('sp_server_diagnostics_component_result') THEN event_data.value('(event/data[@name="component"]/text)[1]', 'nvarchar(20)') ELSE NULL END AS [component]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="connection_id"]/value)[1]', 'uniqueidentifier') ELSE NULL END AS [connection_id]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="connection_peer_id"]/value)[1]', 'uniqueidentifier') ELSE NULL END AS [connection_peer_id]
		,CASE WHEN event_name in ('clr_allocation_failure','clr_virtual_alloc_failure') THEN event_data.value('(event/data[@name="critical_level"]/text)[1]', 'nvarchar(20)') ELSE NULL END AS [critical_level]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="currently_allocated"]/value)[1]', 'bigint') ELSE NULL END AS [currently_allocated]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="currently_predicated"]/value)[1]', 'bigint') ELSE NULL END AS [currently_predicated]
		,CASE WHEN event_name in ('sp_server_diagnostics_component_result') THEN event_data.value('(event/data[@name="data"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [data]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/action[@name="database_id"]/value)[1]', 'int') ELSE NULL END AS [database_id]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="delta_time"]/value)[1]', 'int') ELSE NULL END AS [delta_time]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="destination"]/text)[1]', 'nvarchar(30)') ELSE NULL END AS [destination]
		,CASE WHEN event_name in ('wait_info','wait_info_external') THEN event_data.value('(event/data[@name="duration"]/value)[1]', 'bigint') ELSE NULL END AS [duration]
		,CASE WHEN event_name in ('security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="error_code"]/value)[1]', 'int') ELSE NULL END AS [error_code]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="error_number"]/value)[1]', 'int') ELSE NULL END AS [error_number]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="factor"]/text)[1]', 'nvarchar(20)') ELSE NULL END AS [factor]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="failure"]/text)[1]', 'nvarchar(30)') ELSE NULL END AS [failure]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded','memory_broker_ring_buffer_recorded','memory_node_oom_ring_buffer_recorded','scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded','security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="id"]/value)[1]', 'int') ELSE NULL END AS [id]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="is_intercepted"]/value)[1]', 'nvarchar(10)') ELSE NULL END AS [is_intercepted]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="kernel_mode_time"]/value)[1]', 'bigint') ELSE NULL END AS [kernel_mode_time]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="last_error"]/value)[1]', 'int') ELSE NULL END AS [last_error]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="local_host"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [local_host]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="local_port"]/value)[1]', 'int') ELSE NULL END AS [local_port]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="login_task_enqueued_ms"]/value)[1]', 'int') ELSE NULL END AS [login_task_enqueued_ms]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="login_trigger_and_resource_governor_processing_ms"]/value)[1]', 'int') ELSE NULL END AS [login_trigger_and_resource_governor_processing_ms]
		,CASE WHEN event_name in ('scheduler_monitor_non_yielding_rm_ring_buffer_recorded') THEN event_data.value('(event/data[@name="memory_allocated"]/value)[1]', 'bigint') ELSE NULL END AS [memory_allocated]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="memory_node_id"]/value)[1]', 'int') ELSE NULL END AS [memory_node_id]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="memory_ratio"]/value)[1]', 'bigint') ELSE NULL END AS [memory_ratio]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="memory_utilization"]/value)[1]', 'int') ELSE NULL END AS [memory_utilization]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="memory_utilization_pct"]/value)[1]', 'int') ELSE NULL END AS [memory_utilization_pct]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="message"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [message]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="network_reads_ms"]/value)[1]', 'int') ELSE NULL END AS [network_reads_ms]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="network_writes_ms"]/value)[1]', 'int') ELSE NULL END AS [network_writes_ms]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="new_target"]/value)[1]', 'bigint') ELSE NULL END AS [new_target]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded') THEN event_data.value('(event/data[@name="node_id"]/value)[1]', 'int') ELSE NULL END AS [node_id]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="notification"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [notification]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','wait_info','wait_info_external') THEN event_data.value('(event/data[@name="opcode"]/text)[1]', 'nvarchar(10)') ELSE NULL END AS [opcode]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="os_error"]/value)[1]', 'int') ELSE NULL END AS [os_error]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="overall"]/value)[1]', 'bigint') ELSE NULL END AS [overall]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="page_faults"]/value)[1]', 'int') ELSE NULL END AS [page_faults]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="pages_kb"]/value)[1]', 'bigint') ELSE NULL END AS [pages_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="pool_metadata_id"]/value)[1]', 'int') ELSE NULL END AS [pool_metadata_id]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="previously_allocated"]/value)[1]', 'bigint') ELSE NULL END AS [previously_allocated]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="process_utilization"]/value)[1]', 'int') ELSE NULL END AS [process_utilization]
		,CASE WHEN event_name in ('memory_broker_ring_buffer_recorded') THEN event_data.value('(event/data[@name="rate"]/value)[1]', 'bigint') ELSE NULL END AS [rate]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="remote_host"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [remote_host]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="remote_port"]/value)[1]', 'int') ELSE NULL END AS [remote_port]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="reserved_kb"]/value)[1]', 'bigint') ELSE NULL END AS [reserved_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="resources"]/value)[1]', 'bigint') ELSE NULL END AS [resources]
		,CASE WHEN event_name in ('scheduler_monitor_non_yielding_ring_buffer_recorded') THEN event_data.value('(event/data[@name="scheduler"]/value)[1]', 'int') ELSE NULL END AS [scheduler]
		,CASE WHEN event_name in ('clr_allocation_failure','clr_virtual_alloc_failure','connectivity_ring_buffer_recorded','error_reported','memory_node_oom_ring_buffer_recorded','security_error_ring_buffer_recorded','wait_info','wait_info_external') THEN event_data.value('(event/action[@name="session_id"]/value)[1]', 'int') ELSE NULL END AS [session_id]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="severity"]/value)[1]', 'int') ELSE NULL END AS [severity]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="shared_committed_kb"]/value)[1]', 'bigint') ELSE NULL END AS [shared_committed_kb]
		,CASE WHEN event_name in ('wait_info') THEN event_data.value('(event/data[@name="signal_duration"]/value)[1]', 'bigint') ELSE NULL END AS [signal_duration]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="sni_consumer_error"]/value)[1]', 'int') ELSE NULL END AS [sni_consumer_error]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="sni_error"]/value)[1]', 'int') ELSE NULL END AS [sni_error]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="sni_provider"]/value)[1]', 'int') ELSE NULL END AS [sni_provider]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="source"]/text)[1]', 'nvarchar(20)') ELSE NULL END AS [source]
		,CASE WHEN event_name in ('error_reported','memory_node_oom_ring_buffer_recorded','wait_info','wait_info_external') THEN event_data.value('(event/action[@name="sql_text"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [sql_text]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="ssl_processing_ms"]/value)[1]', 'int') ELSE NULL END AS [ssl_processing_ms]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="sspi_processing_ms"]/value)[1]', 'int') ELSE NULL END AS [sspi_processing_ms]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded','error_reported','sp_server_diagnostics_component_result') THEN event_data.value('(event/data[@name="state"]/text)[1]', 'nvarchar(10)') ELSE NULL END AS [state]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="system_idle"]/value)[1]', 'int') ELSE NULL END AS [system_idle]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="target_kb"]/value)[1]', 'bigint') ELSE NULL END AS [target_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="task"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [task]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="tds_flags"]/text)[1]', 'nvarchar(40)') ELSE NULL END AS [tds_flags]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="tds_input_buffer_bytes"]/value)[1]', 'int') ELSE NULL END AS [tds_input_buffer_bytes]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="tds_input_buffer_error"]/value)[1]', 'int') ELSE NULL END AS [tds_input_buffer_error]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="tds_output_buffer_error"]/value)[1]', 'int') ELSE NULL END AS [tds_output_buffer_error]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded','memory_broker_ring_buffer_recorded','memory_node_oom_ring_buffer_recorded','scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded','security_error_ring_buffer_recorded') THEN event_data.value('(event/data[@name="timestamp"]/value)[1]', 'bigint') ELSE NULL END AS [timestamp]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="total_login_time_ms"]/value)[1]', 'int') ELSE NULL END AS [total_login_time_ms]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="total_page_file_kb"]/value)[1]', 'bigint') ELSE NULL END AS [total_page_file_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="total_physical_memory_kb"]/value)[1]', 'bigint') ELSE NULL END AS [total_physical_memory_kb]
		,CASE WHEN event_name in ('memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/data[@name="total_virtual_address_space_kb"]/value)[1]', 'bigint') ELSE NULL END AS [total_virtual_address_space_kb]
		,CASE WHEN event_name in ('error_reported','memory_node_oom_ring_buffer_recorded') THEN event_data.value('(event/action[@name="tsql_stack"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [tsql_stack]
		,CASE WHEN event_name in ('connectivity_ring_buffer_recorded') THEN event_data.value('(event/data[@name="type"]/text)[1]', 'nvarchar(20)') ELSE NULL END AS [type]
		,CASE WHEN event_name in ('error_reported') THEN event_data.value('(event/data[@name="user_defined"]/value)[1]', 'nvarchar(10)') ELSE NULL END AS [user_defined]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="user_mode_time"]/value)[1]', 'bigint') ELSE NULL END AS [user_mode_time]
		,CASE WHEN event_name in ('wait_info','wait_info_external') THEN event_data.value('(event/data[@name="wait_type"]/text)[1]', 'nvarchar(50)') ELSE NULL END AS [wait_type]
		,CASE WHEN event_name in ('scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded') THEN event_data.value('(event/data[@name="worker"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [worker]
		,CASE WHEN event_name in ('scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded') THEN event_data.value('(event/data[@name="worker_utilization"]/value)[1]', 'int') ELSE NULL END AS [worker_utilization]
		,CASE WHEN event_name in ('scheduler_monitor_deadlock_ring_buffer_recorded','scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded','scheduler_monitor_system_health_ring_buffer_recorded') THEN event_data.value('(event/data[@name="working_set_delta"]/value)[1]', 'bigint') ELSE NULL END AS [working_set_delta]
		,CASE WHEN event_name in ('xml_deadlock_report') THEN event_data.value('(event/data[@name="xml_report"]/value)[1]', 'nvarchar(4000)') ELSE NULL END AS [xml_report]
		,CASE WHEN event_name in ('scheduler_monitor_non_yielding_iocp_ring_buffer_recorded','scheduler_monitor_non_yielding_ring_buffer_recorded','scheduler_monitor_non_yielding_rm_ring_buffer_recorded','scheduler_monitor_stalled_dispatcher_ring_buffer_recorded') THEN event_data.value('(event/data[@name="yields"]/value)[1]', 'bigint') ELSE NULL END AS [yields]
		FROM (
				SELECT td.query('.') AS event_data
				,td.value('@name', 'sysname') as event_name
				,td.value('@timestamp', 'datetime') as timestamp
				FROM 
				(
					SELECT CAST(target_data AS XML) as target_data
					FROM sys.dm_xe_sessions AS s    
					JOIN sys.dm_xe_session_targets AS t
						ON s.address = t.event_session_address
					WHERE s.name = 'system_health'
						AND t.target_name = 'ring_buffer'
				) AS sub
				CROSS APPLY target_data.nodes('RingBufferTarget[1]/event') AS q(td)
			) a
		